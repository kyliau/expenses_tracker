{% extends "templates/base.html" %}
{% block container %}
<div class="panel panel-default">
  <div class="panel-body">
    <form method="POST">
      <div class="form-group">
        <label for="project-name">Project Name</label>
        <input type="text" class="form-control" id="project-name" name="project_name" placeholder="Project Name" required>
      </div>
      <p>Enter the email address of people you would like to add to this project.</p>
      <p>You do not need to enter your email address.</p>
      <table class="table">
        <caption>Moderators are allowed to edit transactions in the project.</caption>
        <thead>
          <tr>
            <th>#</th>
            <th>Email Address</th>
            <th class="text-center">Moderator</th>
            <th class="text-center">Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for i in range(4) %}
          <tr {% if i == 0 %}class="hidden" id="template-row"{% endif %}>
            <th scope="row">{{i}}</th>
            <td><input type="email" class="form-control" placeholder="Email"></td>
            <td class="text-center"><input type="checkbox"></td>
            <td class="text-center"><span class="glyphicon glyphicon-remove text-danger" aria-hidden="true"></span></td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th scope="row"><span class="glyphicon glyphicon-plus text-success" aria-hidden="true" id="addrow"></span></th>
            <td>Click to add more users</td>
            <td></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
      <div class="checkbox">
        <label>
          <input name="notify_all_participants" type="checkbox"> Send notification email to all participants
        </label>
      </div>
      <button type="submit" class="btn btn-default">Create Project</button>
      <input type="hidden" name="num_participants">
      <input type="hidden" name="participants">
      <input type="hidden" name="num_moderators">
      <input type="hidden" name="moderators">
    </form>
  </div>
</div>
{% endblock %}
{% block javascript %}
<script>
function renumberRows() {
  $("tbody th").each(function(index) {
    $(this).text(index);
  });
};

$(document).ready(function() {
  $('#addrow').click(function(e) {
    $("#template-row").clone(true).removeClass("hidden").appendTo("tbody");
    renumberRows();
  });
  $('.glyphicon-remove').click(function(e) {
    $(this).closest('tr').remove();
    renumberRows();
  });
  $('form').submit(function(e) {
    //e.preventDefault();
    var participants = [];
    var moderators   = [];
    $('input[type=email]').each(function() {
      var value = this.value.trim();
      var isModerator = $(this).closest('td').next().children().is(':checked');
      if (value) {
        participants.push(value);
        if (isModerator) {
          moderators.push(value);
        }
      }
    });
    $('input[name=num_participants]').val(participants.length);
    $('input[name=participants]').val(participants.join(','));
    $('input[name=moderators]').val(moderators.join(','));
    $('input[name=num_moderators]').val(moderators.length);
  });
});
</script>
{% endblock %}
{# vim:set tabstop=2 shiftwidth=2 softtabstop=2 expandtab: #}

